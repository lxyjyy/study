<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content=" width=1280,user-scalable=no;">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>中信海博</title>
    <link rel="shortcut icon" href="${ctx}/themes/b2b2cv2/cardorder/images/favicon.ico" type="image/x-icon"/>
    <meta name="keywords" content="西藏中信海博电子科技有限公司">
    <meta name="description"
          content="">
    <!--[if IE]>
    <script type="text/javascript" src="/areas/portal/content/js/html5.js"></script>
    <style>
        article, aside, dialog, figure, footer, header, hgroup, menu, nav, section {
            display: block;
        }
    </style>
    <![endif]-->
    <link rel="stylesheet" href="${ctx}/themes/b2b2cv2/cardorder/css/main.css">
    <script src="${ctx}/themes/b2b2cv2/cardorder/js/jquery.min.js"></script>
    <style>
        body {  font-size: 12px !important;  }
        body * {  max-height: 999999px;  }
        input,input:focus,input:active{user-select: text;}
        .bde7 {  border: 2px solid #e7e7e7;  }
    </style>
    <script>
        document.getElementsByTagName("html")[0].style.fontSize = document.documentElement.clientWidth + "px";
    </script>
</head>

<body>

	<input type="hidden" id="order_sn" 
		<#if dataObj??>
			value="${dataObj.order_sn!''}"
		<#elseif order_sn??>
			value="${order_sn!''}"
		</#if>
	/>
	<input type="hidden" id="receive_user" 
		<#if dataObj??>
			value="${dataObj.receive_user!''}"
		<#elseif receive_user??>
			value="${receive_user!''}"
		</#if>
	/>
	<input type="hidden" id="user_telephone" 
		<#if dataObj??>
			value="${dataObj.user_telephone!''}"
		<#elseif user_telephone??>
			value="${user_telephone!''}"
		</#if>
	/>
    <input type="hidden" id="status" 
    	<#if dataObj??>
    		value="${dataObj.status!''}"
    	<#elseif status??>
			value="${status!''}"
    	</#if>
    />

<div class="w">
    <div class="ff40  tc w "><span class="goBack2 " onclick="javascript:history.back(-1)"></span>
        <img src="${ctx}/themes/b2b2cv2/cardorder/images/wish_app_top.jpg" width="100%" height="100%"/>
    </div>

    <div class="ff24 mm5 llhh35" >
        <p class="ff35 llhh40 tc fb">2017年伊始，许个旅程心愿吧！</p>
        <p class="tl t2 mt20">西藏一个神秘地域，它有震撼心灵的神山圣湖，广袤无边的荒漠草原，濒临灭绝的珍禽异草，虔诚的信徒，淳朴的藏民，飘着酥油香味的风...这一切令人神往，我们邀您去西藏，您最想领略哪里风光？</p>
        <p class="llhh70 tr fb"><b>许愿人：<input type="text" id="wisher" style="border: 0px;border-bottom: 1px solid #333;width: 80%;font-size: 0.024rem;"></b></p>
        <p class="llhh70 tr fb mmb2"><b>联系方式：<input type="text" id="mobile" style="border: 0px;border-bottom: 1px solid #333;width: 80%;font-size: 0.024rem;"></b></p>
        <div class="m0  bde7 tl">
            <div class="mm2 ff24 llhh50 ">
                <p class="mt15 "><b class="fb">＊最想去的地方</b><span class="c999">（最多可选3项）</span></p>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place" type="checkbox" value="1">布达拉宫</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="2">珠穆朗玛峰</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="3">纳木错</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="4">大昭寺</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="5">然乌湖</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="6">古格王朝遗址</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="7">羊卓雍错</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="8">罗布林卡</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="9">札什伦布寺</label></div>
                <div class="mui-checkbox-con"><label><input class="mui-checkbox" name="place"  type="checkbox" value="10">鲁朗</label></div>
            </div>
        </div>
        <div class="w tc " >
            <div class="wish_app_click">许&nbsp;&nbsp;愿</div>
        </div>
    </div>
    <div class="ff20" style="margin-top: 0.02rem;text-align: center;">
        版权所有&copy;2016 西藏中信海博电子科技有限公司 京ICP备10051071号-1
    </div>
</div>
<script>
    $("#wisher").val($("#receive_user").val());
    $("#mobile").val($("#user_telephone").val());

    var isMob = /^((\d{3}-\d{8}|\d{4}-\d{7,8})|(1[3|5|7|8][0-9]{9}))$/;

    //联系电话
//    $('#mobile').blur(function () {
//        var phone = $("#mobile").val();
//        if (isMob.test(phone)) {
//        } else {
//            alert("请输入正确的手机号");
//        }
//    });

    $(".wish_app_click").click(function () {
        var wisher = $("#wisher").val();
        if (wisher == "" || wisher == null) {
            alert("请填写许愿人名称！");
            return;
        }

        var phone = $("#mobile").val();
        if (phone == "" || phone == null) {
            alert("联系方式不能为空！");
            return;
        }

        if(!isMob.test(phone)){
            alert("请输入正确的手机号");
            return;
        }

//       验证选取地区的个数
        var checks = document.getElementsByName("place");
        var n = 0;
        for (var i = 0; i < checks.length; i++) {
            if (checks[i].checked) {
                n++;
            }
        }
        if (n > 3 || n < 1) {
            alert("最少选1个地方，最多选3个地方。");
            return;
        }

        var wish_items = "";
        if(checks.length > 0){
            for (var i = 0; i < checks.length; i++) {
                if (checks[i].checked) {
                    if(wish_items == ""){
                        wish_items = checks[i].value;
                    }else{
                        wish_items += "," + checks[i].value;
                    }
                }
            }
        }

        var order_sn = $("#order_sn").val();
        $.ajax({
            url : "${ctx}/api/b2b2c/storeApi!saveWishes.do?ajax=yes",
            type : "POST",
            data : "wisher="+wisher+"&wisher_telephone="+phone+"&wish_items="+wish_items+"&order_sn="+order_sn,
            async : false,
            dataType : "json",
            success : function(data){
                if(data.result == 1){
                    alert(data.message);
                    if(order_sn != ""){
                        var user_telephone = $("#user_telephone").val();
                        var status = $("#status").val();
                        window.location.href = "${ctx}/cardorder/order_list_app.html?user_telephone="+user_telephone+"&status="+status;
                    }else{
                        window.location.href = "${ctx}/cardorder/index.html";
                    }
                }else{
                    alert(data.message);
                }
            },
            error : function(){
                alert("请求失败");
            }
        });

    });
</script>
</body>
</html>