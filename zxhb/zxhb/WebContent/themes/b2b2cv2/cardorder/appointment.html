<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=1280">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>中信海博</title>
    <link rel="shortcut icon" href="${ctx}/themes/b2b2cv2/cardorder/images/favicon.ico" type="image/x-icon" />

    <meta name="keywords" content="西藏中信海博电子科技有限公司">
    <meta name="description"
          content="">
    <!--[if IE]>
    <script type="text/javascript" src="/areas/portal/content/js/html5.js"></script>
    <style>
        article, aside, dialog, figure, footer, header, hgroup, menu, nav, section {
            display: block;
        }
    </style>
    <![endif]-->
    <link rel="stylesheet" href="${ctx}/themes/b2b2cv2/cardorder/css/main.css">
    <script type="text/javascript" src="${ctx}/themes/b2b2cv2/cardorder/js/jquery.min.js"></script>
    <script type="text/javascript" src="${ctx}/themes/b2b2cv2/cardorder/js/jquery.form-3.51.js"></script>
</head>

<body >
<header>
    <div class="box">
        <a href="${ctx}/cardorder/index.html"><div class="logo w250 h70"></div></a>
        <div class="nav ">
            <ul class="fl tc">
                <li class="fl ml160"><a href="${ctx}/cardorder/index.html">首页</a></li>
                <li class="fl selected"><a href="${ctx}/cardorder/selecting.html">立即购买</a></li>
                <li class="fl "><a href="${ctx}/cardorder/order_list.html">订单查询</a></li>
                <li class="fl "><a href="${ctx}/cardorder/about_us.html">关于我们</a></li>
            </ul>
        </div>
    </div>
</header>
<#assign zxCardGoodsInfoTag=newTag("zxCardGoodsInfoTag")/>
<#assign goodsInfo=zxCardGoodsInfoTag("'goods_id':'${goods_id!''}', 'gg_spec_value_id':'${gg_spec_value_id!''}', 'ta_spec_value_id':'${ta_spec_value_id!''}'")/>
<div class="box cb ">
    <div class="bdfc fl w p10 mt20 bgf7">
        <div class="fl p10 bdfc border2 bgff ">
            <img src="${goodsInfo.ta_image!''}" alt="">
        </div>
		
		<div class="fl ml20 lh25 f14" style="width: 55%;">
            <p class="f16 fb mt20">${goodsInfo.goods.name!''}</p>
            <p class=" ">${goodsInfo.goods.intro!''}</p>
            <div><span>规格：${goodsInfo.gg_value!''}</span></div>
            <div><span>图案：${goodsInfo.ta_value!''}</span></div>
            <div><span>价格：${goodsInfo.card_price!''}元</span></div>
        </div>
		<!-- 
        <div class="fl ml20 lh25 f14">
            <p class="f16 fb mt20">西藏交通一卡通纪念卡</p>
            <p class=" ">5万套交通纪念卡限量发售，以救度佛母二十一种礼赞经为背景，其中部分纪念卡为班禅活佛开光，极具收藏价值！</p>
            <div><span>规格：异形卡</span></div>
            <div><span>图案：双鱼异形卡</span></div>
        </div>
         -->
    </div>
    <div class="">
        <div id="date">
            <form action="" id="dataForm" method="post">
            
            	<input type="hidden" name="goods_id" id="goods_id" value="${goods_id!''}"/>
            	<input type="hidden" name="gg_spec_value_id" id="gg_spec_value_id" value="${gg_spec_value_id!''}"/>
            	<input type="hidden" name="ta_spec_value_id" id="ta_spec_value_id" value="${ta_spec_value_id!''}"/>
            	<input type="hidden" id="referee_code" name="referee_code" value="${referee_code!''}"/>
                <div id="content">
                    <div class="date_2 ">
                        <ul class="date_left">
                            <li>联系人 <span>*</span></li>
                            <li>手机号 <span>*</span></li>
                            <li>验证码 <span>*</span></li>
                            <li>数 量 <span>*</span></li>
                            <li>金额 <span>*</span></li>
                            <li>邮寄地址<span>*</span></li>
                        </ul>
                        <ul class="date_right">
                            <li>
                            	<input type="text" id="contactName" name="contactName" placeholder="联系人姓名" maxlength="20">
                            	<span id="contactName_span"></span></li>
                            <li>
                            	<input type="text" id="mobile" name="contactPhone" placeholder="请输入手机号" maxlength="11">
                            	<span id="phone_span"></span>
                            </li>
                            <li>
                            	<input type="text" id="checkCode" name="checkCode" style="width: 160px;" placeholder="请输入验证码"  maxlength="6">
                            	<input type="button" class="btn_yz pl0 cp border0" value="获取短信验证码">
                            	<span id="checkCode_span"></span>
                            </li>
                            <li>
                            	<input class="minus pl0" type="button" value="—"><input type="text" id="order_count" name="order_count" class="w60 ml3 pl0 numbers" value="1" onblur="getTotalPrice(this.value);" onkeyup="value=value.replace(/[^\d]/g,'')" maxlength="4"/><input class="addition ml3 pl0 f18" type="button" value="+">
                            	<span class="c999">（单位：张/套）</span>
                            </li>
                            <li>
                            	<span class="ml10" id="total_price">${goodsInfo.card_price!''}</span>元
                            </li>
                            <li>
                            	<input type="text" id="address" name="address" placeholder="请输入邮寄地址">
                            	<span id="address_span"></span>
                            </li>
                            <li>
                            	<div class="cb tc w270 date_bottom " id="btnForm" ><span class="bg13 dip w120 h40 lh40 br5 ff16 cfff">提&nbsp;&nbsp;&nbsp;交</span></div>
                            </li>
                        </ul>
                    </div>

                </div>
            </form>
        </div>


    </div>
    <div class=" cb pt15 c999">
        <p>温馨提示：</p>
        <p>请确认您购买信息，提交后将不能更改；</p>
        <p>本纪念卡一经售出除质量外概不退换；</p>
        <p>本纪念卡可在加入全国交通一卡通城市的公交、地铁等公共交通上进行使用，目前仅限在发卡地区进行充值。</p>
    </div>
</div>
<footer class="tc f14 mt100">
    版权所有&copy;2016 西藏中信海博电子科技有限公司 京ICP备10051071号-1
</footer>
<script>

	//提交按钮,所有验证通过方可提交
	$('#btnForm').click(function () {
		var contactName = $("#contactName").val();
	    var mobile = $("#mobile").val();
	    var address = $("#address").val();
	    var checkCode = $("#checkCode").val();
	    
	    var flag = false;
		
		if (contactName==""||contactName==null){
	        $("#contactName_span").addClass("error_no");
	        flag = true;
	    }
		if (checkCode==""||checkCode==null){
	        $("#checkCode_span").addClass("error_no");
	        flag = true;
	    }
		if (contactName==""||contactName==null){
	        $("#contactName_span").addClass("error_no");
	        flag = true;
	    }
	    if (mobile==""||mobile==null){
	        $("#phone_span").addClass("error_no");
	        flag = true;
	    }
	    if (address==""||address==null){
	        $("#address_span").addClass("error_no");
	        flag = true;
	    }
	    
	    if(flag){
	    	return false;
	    }

	    var options = {
             url: "${ctx}/api/b2b2c/storeApi!createUserAndOrder.do?ajax=yes",
             type: "POST",
             async: false,
             dataType: "json",
             success: function (json) {
                 if (json.result == 0) {
                     alert(json.message);
                 } else {
                     //alert(json.message);
                     //window.location.href = "future.html";
                	 window.location.href = "${ctx}/cardorder/payment.html?mobile="+json.mobile+"&order_id="+json.order_id;
                 }
             },
             error: function (jqXHR, textStatus, errorThrown) {
             	//alert(jqXHR);
             	//alert(textStatus);
             	//alert(errorThrown);
                 alert("出现错误，请重试");
             }
        };
        $("#dataForm").ajaxSubmit(options);
	});

    //var isMob = /^1[34578]\d{9}$/;
    var isMob = /^((\d{3}-\d{8}|\d{4}-\d{7,8})|(1[3|5|7|8][0-9]{9}))$/;

    // 联系人
    $('#contactName').blur(function () {
        if ($(this).val().length >= 2 && $(this).val().length <= 20 && $(this).val() != '') {
            $(this).next().removeClass('error_no').addClass('correct');
        } else {
            $(this).next().removeClass('correct').addClass('error_no');
        }

    });
    //联系电话
    $('#mobile').blur(function () {
        var phone= $("#mobile").val();
        if(isMob.test(phone)){
            $(this).next().removeClass('error_no').addClass('correct');
        } else {
            $(this).next().removeClass('correct').addClass('error_no');
        }

    });
 	// 验证码
    $('#checkCode').blur(function () {
        if ($(this).val().length >= 2 && $(this).val().length <= 6 && $(this).val() != '') {
            $(this).next().next().removeClass('error_no').addClass('correct');
        } else {
            $(this).next().next().removeClass('correct').addClass('error_no');
        }

    });
    //地址
    $('#address').blur(function () {
        var address= $("#address").val();
        if(address!="" && address!=null){
            $(this).next().removeClass('error_no').addClass('correct');
        } else {
            $(this).next().removeClass('correct').addClass('error_no');
        }

    });

    
	//数字加减法
    $('.minus').click(function () {
    	var numbers=$("#order_count").val();
        if(numbers>1){
            numbers -- ;
            $("#order_count").val(numbers);
        }else {
            $("#order_count").val("1");
        }
        var price = '${goodsInfo.card_price!''}';
        var total_price = parseInt(price) * parseInt(numbers);
        $("#total_price").html(total_price);
    });
    $('.addition').click(function () {
    	var numbers=$("#order_count").val();
        numbers ++ ;
        if(numbers > 9999){
        	$("#order_count").val(9999);
        }else{
        	$("#order_count").val(numbers);
        }
        var price = '${goodsInfo.card_price!''}';
        var total_price = parseInt(price) * parseInt(numbers);
        $("#total_price").html(total_price);
    });
    
    function getTotalPrice(count){
    	var price = '${goodsInfo.card_price!''}';
    	var total_price = parseInt(price) * parseInt(count);
        $("#total_price").html(total_price);
    }
    
    /*获取验证码倒计时*/
    var wait=60;
    function time(o) {
        if (wait == 0) {
            o.removeAttribute("disabled");
            o.value="获取短信验证码";
            wait = 60;
            $(".btn_yz").css("background-color","#c4a152");
            $(".btn_yz").css("color","#fff");
        } else {
            o.setAttribute("disabled", true);
            o.value=wait+"s后"+"重新发送";
            wait--;
            setTimeout(function() {
                time(o)
            }, 1000)
            $(".btn_yz").css("background-color","#f1f1f1");
            $(".btn_yz").css("color","#666");
        }
    }
    
    $(".btn_yz").click(function(){
    	var mobile = $("#mobile").val();
    	if(mobile == ""){
    		alert('请输入要发送验证码的手机号码');
            return false;
    	}
    	if(!/^((\d{3}-\d{8}|\d{4}-\d{7,8})|(1[3|5|7|8][0-9]{9}))$/.test(mobile)){
    		alert('请输入正确的手机号码');
            return false;
    	}

    	time(this);
    	
    	$.ajax({
            url: "${ctx}/api/b2b2c/storeApi!sendOrderCheckCode.do?ajax=yes",
            type: "POST",
            data: "mobile=" + mobile,
            async: false,
            dataType: "json",
            success: function (json) {

            }
        });
    });
    
</script>

</body>
</html>