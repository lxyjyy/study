<#include '/store/store_header.html' />
<!-- 调用地区标签 -->
<#assign regionSelect = "com.enation.app.shop.core.tag.regions.RegionSelectDirective"?new()>
    <link rel="stylesheet" type="text/css" href="${ctx}/themes/b2b2cv2/css/uploadify.css"/>
    <script type="text/javascript" src="${ctx}/themes/b2b2cv2/js/jquery.uploadify.min.js"></script>
    <style>
        input[type="file"] {
            height: 20px;
        }

        .open_store_form {
            width: 100%;
        }

        .bg_fen {
            background-color: #ffe8d9;
        }

        .btn_yz {
            background-color: #5bb75b;
            border: 1px solid #d2d2d2;
            color: #fff;
            padding: 4px;
            width: 100px;
            text-align: center;
            margin-left: 5px;

        }

        .btn_yz:hover {
            background-color: #c8c8c8
        }
    </style>

    <div class="store_main">
        <div style="width: 1200px;margin: 0 auto;">
            <div style="width: 200px">

            </div>
            <div class="sotre_right_content">
                <div class="open_store_form">
                    <form id="applyForm" action="" method="post" class="validate">
                        <div id="step1">
                            <div class="bg_fen p5 f16 pl30 color_ju">企业基本信息</div>
                            <dl>
                                <dt class="required">
                                    <em class="pngFix"></em>店铺名称：
                                </dt>
                                <dd>
                                    <p><input type="text" id="store_name" name="store_name" maxlength="20"
                                              class="text store_name_title" value="${myStoreDetail.store_name!''}" isrequired="true"/></p>
                                    <p class="hint">请控制在20个字符以内</p>
                                </dd>
                            </dl>
                             <dl>
                                  <dt class="required"><em class="pngFix" id="id_logo"></em>店铺logo:<span id="id_imgText"></span></dt>
		                          <dd>
		                              <div class="apply_id_img" status="id_img">
		                                  <#if myStoreDetail.store_logo??>
		                                      <@image src="${myStoreDetail.store_logo}" width="100" height="100"/>
		                                  </#if>
		                              </div>
		                              <input type="file" id="id_img" status="id_img"/>
		                              &nbsp;&nbsp;<span class="applyPro">支持格式jpg,jpeg,png,gif，请保证图片清晰且文件大小不超过400KB</span>
		                              <input type="hidden" name="store_logo" id="id_imgImg" value="${myStoreDetail.store_logo!''}"/>
		                              <input type="hidden" name="store_name_auth" 
		                              <#if myStoreDetail??>value="2"
		                                  <#else> value="0"
		                              </#if>
		                              id="id_imgStatus" />
		                          </dd>
	                        </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>所在地区：</dt>
                                <dd><@regionSelect province_name='store_province' city_name='store_city'
                                 		region_name='store_region' province_id="${myStoreDetail.store_provinceid!''}"
                                  		city_id="${myStoreDetail.store_cityid!''}"
                                  		region_id="${myStoreDetail.store_regionid!''}"/>
                                </dd>
                            </dl>

                            <dl>
                                <dt class="required"><em class="pngFix"></em>详细地址：</dt>
                                <dd><input type="text" name="attr" class="text w400" isrequired="true" id="attr"
                                           value="${myStoreDetail.attr!''}"/></dd>
                            </dl>

                            <dl>
                                <dt class="required"><em class="pngFix"></em>邮编：</dt>
                                <dd><input type="text" name="zip" class="text w200" id="store_zip"
                                           isrequired="true" dataType="post_code" value="${myStoreDetail.zip!''}"/></dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>客服电话：</dt>
                                <dd><input type="text" name="customer_phone" class="text w200"
                                           value="${myStoreDetail.customer_phone!''}" dataType="tel_num"
                                           id="service_tel" isrequired="true"/></dd>
                            </dl>


                            <div class="bg_fen p5 f16 pl30 color_ju">联系人信息</div>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>联系人姓名：</dt>
                                <dd><input type="text" name="contacts_name" class="text w200" id="cellphone_name"
                                           isrequired="true" value="${myStoreDetail.contacts_name!''}"/></dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>联系方式：</dt>
                                <dd><input type="text" name="tel" class="text w200" id="cellphone"
                                           dataType="mobile" isrequired="true" value="${myStoreDetail.tel!''}"/></dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>办公电话：</dt>
                                <dd><input type="text" name="office_phone" class="text w200" id="officephone"
                                           dataType="tel_num"
                                           isrequired="true" value="${myStoreDetail.office_phone!''}"/></dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>电子邮箱：</dt>
                                <dd><input type="text" name="email" class="text w200" id="email" dataType="email"
                                           isrequired="true" value="${myStoreDetail.email!''}"/></dd>
                            </dl>
                             <dl>
                                  <dt class="required"><em class="pngFix"></em>上传联系人身份证照片（正面）:<span id="id_img_1Text"></span></dt>
		                          <dd>
		                             <div class="apply_id_img_1" status="id_img_1">
		                                 <#if myStoreDetail.id_img??>
		                                     <@image src="${myStoreDetail.id_img}" width="100" height="100"/>
		                                 </#if>
		                             </div>
		                             <input type="file" id="id_img_1" status="id_img_1"/>
		                             &nbsp;&nbsp;<span class="applyPro">支持格式jpg,jpeg,png,gif，请保证图片清晰且文件大小不超过400KB</span>
		                             <input type="hidden" name="contacts_id_img" id="id_img_1Img" value="${myStoreDetail.id_img!''}"/>
		                             <input type="hidden" name="store_name_auth"
		                             <#if myStoreDetail??>value="2"
		                                 <#else> value="0"
		                             </#if>
		                             id="id_img_1Status" />
		                         </dd>
                           </dl>
                           <dl>
	                              <dt class="required"><em class="pngFix"></em>上传联系人身份证照片（背面）:<span id="id_img_2Text"></span></dt>
		                          <dd>
		                             <div class="apply_id_img_2" status="id_img_2">
		                                 <#if myStoreDetail.contact_idimg_back??>
		                                     <@image src="${myStoreDetail.contact_idimg_back}" width="100" height="100"/>
		                                 </#if>
		                             </div>
		                             <input type="file" id="id_img_2" status="id_img_2"/>
		                             &nbsp;&nbsp;<span class="applyPro">支持格式jpg,jpeg,png,gif，请保证图片清晰且文件大小不超过400KB</span>
		                             <input type="hidden" name="contact_idimg_back" id="id_img_2Img" value="${myStoreDetail.contact_idimg_back!''}"/>
		                             <input type="hidden" name="store_name_auth"
		                             <#if myStoreDetail??>value="2"
		                                 <#else> value="0"
		                             </#if>
		                             id="id_img_2Status" />
		                         </dd>
                           </dl>


                            <div class="bg_fen p5 f16 pl30 color_ju">经营范围</div>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>企业法人姓名：</dt>
                                <dd><input type="text" name="corporation" class="text w200"
                                           id="name_of_enterprise_legal_person" isrequired="true"
                                           value="${myStoreDetail.corporation!''}"/></dd>
                            </dl>
                            <dl>
                                <dt >企业法人身份证号：</dt>
                                <dd><input type="text" name="corporation_id_number"
                                           class="text w200" id="corporate_identity_card_number" 
                                           value="${myStoreDetail.corporation_id_number!''}"/></dd>
                            </dl>
                            <dl>
                                <dt >上传企业法人身份证照片<br />（正面）:<span id="id_img_legalText"></span></dt>
                                <dd>
                                    <div class="apply_id_img_legal" status="id_img_legal">
                                        <#if myStoreDetail.corporation_id_img??>
                                            <@image src="${myStoreDetail.corporation_id_img}" width="100" height="100"/>
                                        </#if>
                                    </div>
                                    <input type="file" id="id_img_legal" status="id_img_legal"/>
                                    &nbsp;&nbsp;<span class="applyPro">支持格式jpg,jpeg,png,gif，请保证图片清晰且文件大小不超过400KB</span>
                                    <input type="hidden" name="corporation_img" id="id_img_legalImg" value="${myStoreDetail.corporation_id_img!''}"/>
                                    <input type="hidden" name="store_name_auth"
                                    <#if myStoreDetail??>value="2"
                                        <#else> value="0"
                                    </#if>
                                    id="id_img_legalStatus" />
                                </dd>
                            </dl>
                            <dl>
                                <dt >上传企业法人身份证照片<br />（背面）:<span id="id_img_legal2Text"></span></dt>
                                <dd>
                                    <div class="apply_id_img_legal2" status="id_img_legal2">
                                        <#if myStoreDetail.corporate_idimg_back??>
                                            <@image src="${myStoreDetail.corporate_idimg_back}" width="100" height="100"/>
                                        </#if>
                                    </div>
                                    <input type="file" id="id_img_legal2" status="id_img_legal2"/>
                                    &nbsp;&nbsp;<span class="applyPro">支持格式jpg,jpeg,png,gif，请保证图片清晰且文件大小不超过400KB</span>
                                    <input type="hidden" name="corporate_idimg_back" id="id_img_legal2Img" value="${myStoreDetail.corporate_idimg_back!''}"/>
                                    <input type="hidden" name="store_name_auth"
                                    <#if myStoreDetail??>value="2"
                                        <#else> value="0"
                                    </#if>
                                    id="id_img_legal2Status" />
                                </dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>营业执照注册号：</dt>
                                <dd><input type="text" name="bussiness_license_number"
                                           class="text w200" id="license_number" isrequired="true"
                                           value="${myStoreDetail.bussiness_license_number!''}"/></dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>上传营业执照照片:<span id="license_imgText"></span></dt>
                                <dd>
                                    <div class="apply_license_img" status="license_img">
                                        <#if myStoreDetail.license_img??>
                                            <@image src="${myStoreDetail.license_img}" width="100" height="100"/>
                                        </#if>
                                    </div>
                                    <input type="file" id="license_img" status="license_img"/>
                                    &nbsp;&nbsp;<span class="applyPro">支持格式jpg,jpeg,png,gif，请保证图片清晰且文件大小不超过400KB</span>
                                    <input type="hidden" name="licenseImg" id="license_imgImg" value="${myStoreDetail.license_img!''}"/>
                                    <input type="hidden" name="store_store_auth"
                                    <#if myStoreDetail??> value="2"
                                        <#else> value="0"
                                    </#if>
                                    id="license_imgStatus"/> 
                                </dd>
                            </dl>
                            <#assign brandListTag = newTag("brandListTag") /> 
							<#assign brandList = brandListTag() /> 
                            <dl>
                                <dt class="required"><em class="pngFix"></em>代理品牌：</dt>
                                <dd>
                                    <select name="brand" id="select" class="select">
                                        <option value="0">请选择</option>
        							    <#list brandList as brand >
        							    <option value="${brand.brand_id}" <#if myStoreDetail.brand_id==brand.brand_id>selected="selected"</#if>>${brand.name!''}</option>
        							    </#list>
                                    </select>
                                </dd>
                            </dl>

                            <div class="bg_fen p5 f16 pl30 color_ju">账户信息</div>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>银行开户名：</dt>
                                <dd><input type="text" name="bank_account_name" class="text w300"
                                           value="${myStoreDetail.bank_account_name!''}" id="bank_account_name"
                                           isrequired="true"/></dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>公司银行账号：</dt>
                                <dd><input type="text" onKeyUp="this.value=this.value.replace(/\D/g,'')"
                                           name="bank_account_number" class="text w200"
                                           value="${myStoreDetail.bank_account_number!''}" id="bank_account_number"
                                           isrequired="true"/></dd>
                            </dl>
                            <dl>
                                <dt class="required"><em class="pngFix"></em>开户银行支行名称：</dt>
                                <dd><input type="text" name="bank_name" class="text w300"
                                           value="${myStoreDetail.bank_name!''}" id="bank_name" isrequired="true"/></dd>
                            </dl>
                           <!--  <dl>
                                <dt class="required"><em class="pngFix"></em>开户银行详细地址：</dt>
                                <dd><input type="text" name="bank_attr" id="bank_attr" class="text w400"
                                           isrequired="true" value=""/></dd>
                            </dl> -->
                            <dl>
                                <dt class="required"><em class="pngFix"></em>上传银行开户许可证:<span id="bank_license_imgText"></span></dt>
                                <dd>
                                    <div class="apply_bank_license_img" status="bank_license_img">
                                        <#if myStoreDetail.bank_license_img??>
                                            <@image src="${myStoreDetail.bank_license_img}" width="100" height="100"/>
                                        </#if>
                                    </div>
                                    <input type="file" id="bank_license_img" status="bank_license_img"/>
                                    &nbsp;&nbsp;<span class="applyPro">支持格式jpg,jpeg,png,gif，请保证图片清晰且文件大小不超过400KB</span>
                                    <input type="hidden" name="bank_license_img" id="bank_license_imgImg" value="${myStoreDetail.bank_license_img!''}"/>
                                    <input type="hidden" name="store_store_auth"
                                    <#if myStoreDetail??> value="2"
                                        <#else> value="0"
                                    </#if>
                                    id="bank_license_imgStatus"/>
                               </dd>
                            </dl>
                            <dl>
                                <dt><em class="pngFix"></em>支付宝账号：</dt>
                                <dd><input type="text" name="alipay_account" class="text w200"
                                           value="${myStoreDetail.alipay_account!''}" id="alipay"/></dd>
                            </dl>
                            <dl>
                                <dt><em class="pngFix"></em>微信账号：</dt>
                                <dd><input type="text" name="weichat_account" class="text w200"
                                           value="${myStoreDetail.weichat_account!''}" id="wechat"/></dd>
                            </dl>

                            <!--仅设置时显示,浏览信息时不显示-->
                            <div>
                                <div class="bg_fen p5 f16 pl30 color_ju">提现信息</div>
                                <dl>
                                    <dt class="required"><em class="pngFix"></em>登录密码：</dt>
                                    <dd><input type="password" name="user_password" class="text w200" value=""
                                               dataType="" id="user_password"
                                               isrequired="true"/></dd>
                                </dl>
                                <dl>
                                    <dt class="required"><em class="pngFix"></em>提现密码：</dt>
                                    <dd><input type="password" name="cashingout_password" class="text w200" value=""
                                               dataType="" id="cashingout_password"
                                               isrequired="true"/></dd>
                                </dl>
                                <dl>
                                    <dt class="required"><em class="pngFix"></em>提现人手机号：</dt>
                                    <dd><input type="text" name="cashingouter_phone" class="text w200" value="${myStoreDetail.cashingouter_phone!''}"
                                               dataType="tel_num"
                                               id="mobile" isrequired="true"/></dd>
                                </dl>
                                <dl>
                                    <dt class="required"><em class="pngFix"></em>手机验证码：</dt>
                                    <dd><input type="text" id="checkCode" name="checkCode" class="text"
                                               style="width: 90px;" value=""/>
                                        <input id="sendCheckCode" name="sendCheckCode" type="button" class="btn_yz cp"
                                               value="免费获取验证码"
                                               onclick="sentCheckCode()"></dd>
                                </dl>
                                <dl class="bottom">
                                    <dt>&nbsp;</dt>
                                    <dd>
                                        <p class="mb10">
                                            <input type="button" class="submit" value="保 存" id="apply"/>
                                        </p>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">

        $(function () {
        	 bindFileEvent($("#id_img"));
             bindFileEvent($("#id_img_1"));
             bindFileEvent($("#id_img_legal"));
             bindFileEvent($("#license_img"));
             bindFileEvent($("#bank_license_img"));
             bindFileEvent($("#id_img_2"));
             bindFileEvent($("#id_img_legal2"));

            $("#apply").click(function () {
                if (($("#store_province_id").val() == 0) || ($("#store_city_id").val() == 0) || ($("#store_region_id").val() == 0)) {
                    alert("请设置店铺所在区域");
                    return false;
                }
                if (($("#id_imgImg").val() == '') ) {
                    alert("请上传店铺logo");
                    return false;
                }
                if (($("#id_img_1Img").val() == '') ) {
                    alert("请上传联系人身份证照片");
                    return false;
                }
                if (($("#license_imgImg").val() == '') ) {
                    alert("请上传营业执照照片");
                    return false;
                }
                if (($("#bank_license_imgImg").val() == '') ) {
                    alert("请上传银行开户许可证");
                    return false;
                }
                
                if (!$("#applyForm").checkall())
                    return false;
                $("#apply").attr({"disabled": "disabled"});
                
                var options = {
                        url: "${ctx}/api/b2b2c/storeApi!reApply_save.do?ajax=yes",
                        type: "POST",
                        async: false,
                        dataType: "json",
                       	data:{},
                        success: function (json) {
                            if (json.result == 0) {
                                alert(json.message);
                            } else {
                                alert(json.message);
                                location.href = "${ctx}/store/business_center.html?menu=store_index";
                            }
                            $("#apply").removeAttr("disabled");
                        },
                        error: function (e) {
                            alert("出现错误，请重试");
                        }
                    };  
                $('#applyForm').ajaxSubmit(options);
            });
            
            
            $("#region_id").setValidator(function () {
                var value = $("#region_id").val();
                if (value == "" || value == "0") return "地区信息不完整";
                else return true;
            });

            //checkStoreName();//校验店铺名是否重复
        });

        function bindFileEvent(obj) {
            var status = $(obj).attr("status");
            $(obj).uploadify({
                'buttonText': '上传',		//显示文字
                'fileObjName': 'image',		//文件对象名称
                'fileTypeDesc': '请选择',//允许上传的文件类型的描述，在弹出的文件选择框里会显示
                'fileTypeExts': '*.gif; *.jpg; *.png',//允许上传的文件类型，限制弹出文件选择框里能选择的文件
                'uploader': '${ctx}/api/base/upload-image!storeImgUpload.do?subFolder=store',
                'swf': '${ctx}/themes/b2b2cv2/uploadify.swf',
                'height': '30',				//高度
                'width': '80',
                'multi': false,				//是否支持多文件上传
                'progressData': 'percentage',//设置文件上传时显示的数据
                //'uploadLimit': 3,
                'onFallback': function () {				//falsh兼容
                    alert("麻烦了，不兼容falsh!");
                },
                'onUploadSuccess': function (file, data, response) {
                    var img = jQuery.parseJSON(data);
                    //$("#" + status + "Text").html("已上传");
                    $("#" + status + "Img").val(img.fsImg);
                    $("#" + status + "Status").val(2);
                    $(".apply_" + status).html("<img src='" + img.imgUrl + "'style='width:100px;height:100px'/>");
                },
                'onSelectError': function (file, errorCode, errorMsg) {
                    if (errorCode == SWFUpload.QUEUE_ERROR.INVALID_FILETYPE) {
                        this.queueData.errorMsg = "请上传正确的格式";
                    }
                }
            });
        }
        //检测身份证
        function checkIDNumber(value) {
            var type = 1;
            var idNumber = $("#id_number").val();
            var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
            if (!reg.test(idNumber)) {
                alert("身份证格式不正确！");
                $("#id_number").val("");
                return;
            }
            $.ajax({
                url: "${ctx}/api/b2b2c/storeApi!checkIdNumber.do?ajax=yes",
                type: "POST",
                async: false,
                data: "id_number=" + idNumber,
                dataType: "json",
                success: function (json) {
                    type = json.result;
                }
            });
            if (type == 0) {
                alert("身份证重复");
                $("#id_number").val("");
            }
        }
        function checkStoreName(value) {
            var storeName = $("#store_name").val();
            var type = 1;
            if (storeName.length > 20) {
                alert("店铺名称请控制在20个字符以内");
                return;
            }
            $.ajax({
                url: "${ctx}/api/b2b2c/storeApi!checkStoreName.do?ajax=yes",
                type: "POST",
                data: "storeName=" + storeName,
                async: false,
                dataType: "json",
                success: function (json) {
                    type = json.result;
                }
            });
            if (type == 0) {
                return "店铺名称重复";
                $("#store_name").val("");
            }
        }

        //发送验证码
        function sentCheckCode() {
            var mobile = $("#mobile").val();

            if (mobile != "") {
                if (!(/^((\d{3}-\d{8}|\d{4}-\d{7,8})|(1[3|5|7|8][0-9]{9}))$/.test(mobile))) {
                  return false;
               }else {
                    $.ajax({
                        url: "${ctx}/api/b2b2c/storeApi!sendCheckCode.do?ajax=yes",
                        type: "POST",
                        data: "mobile=" + mobile,
                        async: false,
                        dataType: "json",
                        success: function (json) {
                            alert(json.message);
                        }
                    });
                }
            }
        }
        /*获取验证码倒计时*/
        var wait=60;
        function time(o) {
            if (wait == 0) {
                o.removeAttribute("disabled");
                o.value="免费获取验证码";
                wait = 60;
                $(".btn_yz").css("background-color","#5bb75b");
                $(".btn_yz").css("color","#fff");
            } else {
                o.setAttribute("disabled", true);
                o.value=wait+"s后"+"重新发送";
                wait--;
                setTimeout(function() {
                    time(o)
                }, 1000)
                $(".btn_yz").css("background-color","#f1f1f1");
                $(".btn_yz").css("color","#666");
            }
        }
        $(".btn_yz").click(function(){
            time(this);
        });
    </script>
    <#include '/common/footer.html' />